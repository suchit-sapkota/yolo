import serial
import matplotlib.pyplot as plt
import numpy as np

# Set up Serial Communication
arduino = serial.Serial('/dev/ttyACM0', 9600)  # Adjust the port if needed
plt.ion()

fig, ax = plt.subplots(subplot_kw={'projection': 'polar'})
angles = []
distances = []

while True:
    try:
        data = arduino.readline().decode().strip()
        angle, distance = map(float, data.split(','))
        
        # Convert to radians
        angle_rad = np.deg2rad(angle)

        # Update the radar plot
        if len(angles) > 180:  # To keep the plot smooth
            angles.pop(0)
            distances.pop(0)
        angles.append(angle_rad)
        distances.append(distance)

        ax.clear()
        ax.set_ylim(0, max(distances) if distances else 100)  # Set max distance dynamically
        ax.plot(angles, distances, 'g-')
        plt.draw()
        plt.pause(0.01)
    except KeyboardInterrupt:
        break
    except Exception as e:
        print(f"Error: {e}")
        continue

arduino.close()
